<div class="documents-page">
  <header class="page-header">
    <h1>Documents</h1>
    <button class="add-button" (click)="openCreateForm()">
      + New Document
    </button>
  </header>

  <!-- Create/Edit/View Form -->
  @if (showForm()) {
    <div class="document-form">
      @if (currentMode() === 'view') {
        <!-- View Mode -->
        <div class="view-mode">
          <div class="form-header">
            <h2>Document Request</h2>
            <button class="close-btn" (click)="closeForm()">âœ•</button>
          </div>
          
          <div class="view-content">
            <div class="view-section">
              <div class="view-icon">ðŸ“„</div>
              <div class="view-details">
                <div class="view-meta">
                  <span class="document-type">Type: {{ getDocumentTypeName(selectedDocument()?.documentType || '') }}</span>
                  <span class="project">Project: {{ getProjectName(selectedDocument()?.projectId || '') }}</span>
                  <span class="status" [class]="'status-' + selectedDocument()?.status">
                    {{ selectedDocument()?.status | titlecase }}
                  </span>
                  @if (selectedDocument()?.dueDate) {
                    <span class="due-date">
                      Due: {{ selectedDocument()?.dueDate | date:'MMM dd, yyyy' }}
                    </span>
                  }
                  <span class="created-date">
                    Created: {{ selectedDocument()?.createdAt | date:'MMM dd, yyyy' }}
                  </span>
                </div>
                @if (selectedDocument()?.assignedProviders && selectedDocument()!.assignedProviders!.length > 0) {
                  <div class="providers-section">
                    <h4>Assigned Providers:</h4>
                    <div class="providers-list">
                      @for (provider of selectedDocument()!.assignedProviders!; track provider) {
                        <span class="provider-tag">{{ provider }}</span>
                      }
                    </div>
                  </div>
                }
                @if (selectedDocument()?.acceptedProvider) {
                  <div class="accepted-provider">
                    <strong>Accepted Provider:</strong> {{ selectedDocument()?.acceptedProvider }}
                  </div>
                }
              </div>
            </div>
          </div>
          
          <div class="view-actions">
            <button class="btn-edit" (click)="openEditForm(selectedDocument()!)">Edit</button>
            <button class="btn-close" (click)="closeForm()">Close</button>
          </div>
        </div>
      } @else {
        <!-- Create/Edit Form -->
        <div class="form-header">
          <h2>{{ currentMode() === 'create' ? 'Create Document Request' : 'Edit Document Request' }}</h2>
          <button class="close-btn" (click)="closeForm()">âœ•</button>
        </div>

        <form [formGroup]="documentForm" (ngSubmit)="onSubmitForm()">
          <div class="form-row">
            <div class="form-group">
              <label for="projectId">Project *</label>
              <select 
                id="projectId" 
                formControlName="projectId"
                [class.error]="documentForm.get('projectId')?.invalid && documentForm.get('projectId')?.touched"
              >
                <option value="">Select project</option>
                @for (project of projects(); track project.id) {
                  <option [value]="project.id">{{ project.name }}</option>
                }
              </select>
              @if (documentForm.get('projectId')?.invalid && documentForm.get('projectId')?.touched) {
                <div class="error-message">Project is required</div>
              }
            </div>
            <div class="form-group">
              <label for="documentType">Document Type *</label>
              <select 
                id="documentType" 
                formControlName="documentType"
                [class.error]="documentForm.get('documentType')?.invalid && documentForm.get('documentType')?.touched"
              >
                <option value="">Select document type</option>
                @for (docType of documentTypes(); track docType.id) {
                  <option [value]="docType.id">{{ docType.name }}</option>
                }
              </select>
              @if (documentForm.get('documentType')?.invalid && documentForm.get('documentType')?.touched) {
                <div class="error-message">Document type is required</div>
              }
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="status">Status *</label>
              <select id="status" formControlName="status">
                <option value="requested">Requested</option>
                <option value="accepted">Accepted</option>
                <option value="rejected">Rejected</option>
                <option value="provided">Provided</option>
              </select>
            </div>
            <div class="form-group">
              <label for="dueDate">Due Date</label>
              <input 
                id="dueDate" 
                type="date" 
                formControlName="dueDate"
              />
            </div>
          </div>

          <div class="form-group">
            <label for="assignedProviders">Assigned Providers</label>
            <input 
              id="assignedProviders" 
              type="text" 
              formControlName="assignedProviders" 
              placeholder="provider1, provider2, provider3 (comma-separated)"
            />
            <small>Enter provider names separated by commas (optional)</small>
          </div>

          <div class="form-group">
            <label for="acceptedProvider">Accepted Provider</label>
            <input 
              id="acceptedProvider" 
              type="text" 
              formControlName="acceptedProvider" 
              placeholder="Name of the accepted provider"
            />
          </div>

          <div class="form-actions">
            <button 
              type="button" 
              class="btn-cancel" 
              (click)="closeForm()"
              [disabled]="processing()"
            >
              Cancel
            </button>
            <button 
              type="submit" 
              class="btn-submit" 
              [disabled]="!documentForm.valid || processing()"
            >
              {{ processing() ? 'Saving...' : (currentMode() === 'create' ? 'Create' : 'Update') }}
            </button>
          </div>
        </form>
      }
    </div>
  }

  @if (loading()) {
    <div class="loading">Loading documents...</div>
  }

  <div class="documents-list">
    @if (documents().length === 0 && !loading()) {
      <div class="empty-state">
        <p>No document requests found. Create your first document request to get started.</p>
      </div>
    }

    @for (document of documents(); track document.id) {
      <div class="document-card" [class]="'status-' + document.status">
        <div class="document-icon">ðŸ“„</div>
        <div class="document-content">
          <h3>{{ getProjectName(document.projectId) }} - {{ getDocumentTypeName(document.documentType) }}</h3>
          <div class="document-meta">
            <span class="document-type">{{ getDocumentTypeName(document.documentType) }}</span>
            <span class="project">{{ getProjectName(document.projectId) }}</span>
            <span class="status" [class]="'status-' + document.status">{{ document.status | titlecase }}</span>
            @if (document.dueDate) {
              <span class="due-date">Due: {{ document.dueDate | date:'MMM dd, yyyy' }}</span>
            }
            <span class="created-date">{{ document.createdAt | date:'MMM dd, yyyy' }}</span>
          </div>
          @if (document.assignedProviders && document.assignedProviders.length > 0) {
            <div class="providers">
              <strong>Providers:</strong> {{ document.assignedProviders.join(', ') }}
            </div>
          }
          @if (document.acceptedProvider) {
            <div class="accepted-provider">
              <strong>Accepted:</strong> {{ document.acceptedProvider }}
            </div>
          }
        </div>
        <div class="document-actions">
          <button class="action-btn" (click)="openViewMode(document)">View</button>
          <button class="action-btn" (click)="openEditForm(document)">Edit</button>
          <button class="action-btn danger" (click)="deleteDocument(document)" [disabled]="processing()">
            {{ processing() ? '...' : 'Delete' }}
          </button>
        </div>
      </div>
    }
  </div>
</div>