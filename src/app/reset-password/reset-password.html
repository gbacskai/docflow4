<div class="reset-password-page">
  <div class="auth-container">
    <div class="auth-header">
      <div class="reset-icon">
        <svg width="80" height="80" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
          <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
          <circle cx="12" cy="16" r="1"></circle>
          <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
        </svg>
      </div>
      <h1>Reset Your Password</h1>
      <p class="auth-subtitle">
        Enter your email, reset code, and create a new password
      </p>
    </div>

    <div class="reset-form-container" data-test="reset-password-page">
      <form [formGroup]="resetForm" (ngSubmit)="onResetFormSubmit()" class="auth-form">
        <div class="form-group">
          <label for="reset-email">Email Address</label>
          <input
            id="reset-email"
            type="email"
            formControlName="email"
            placeholder="Enter your email address"
            [class.error]="resetForm.get('email')?.invalid && resetForm.get('email')?.touched"
            data-test="reset-email-input"
          />
          @if (resetForm.get('email')?.invalid && resetForm.get('email')?.touched) {
            <div class="error-message">
              @if (resetForm.get('email')?.errors?.['required']) {
                Email is required
              }
              @if (resetForm.get('email')?.errors?.['email']) {
                Please enter a valid email address
              }
            </div>
          }
          
          <div class="send-code-section">
            <button 
              type="button" 
              class="btn-secondary" 
              (click)="onResetRequest()" 
              [disabled]="processing() || !resetForm.get('email')?.valid"
              data-test="send-reset-code-btn"
            >
              {{ processing() ? 'Sending...' : 'Send Reset Code' }}
            </button>
          </div>
        </div>

        <div class="form-group">
          <label for="reset-code">Reset Code</label>
          <input
            id="reset-code"
            type="text"
            formControlName="confirmationCode"
            placeholder="Enter 6-digit reset code"
            maxlength="6"
            [class.error]="resetForm.get('confirmationCode')?.invalid && resetForm.get('confirmationCode')?.touched"
            data-test="reset-code-input"
            style="text-align: center; letter-spacing: 0.3em; font-size: 1.2em; font-weight: 600;"
          />
          @if (resetForm.get('confirmationCode')?.invalid && resetForm.get('confirmationCode')?.touched) {
            <div class="error-message">
              Please enter a valid 6-digit reset code
            </div>
          }
        </div>

        <div class="form-group">
          <label for="new-password">New Password</label>
          <input
            id="new-password"
            type="text"
            formControlName="newPassword"
            placeholder="Enter your new password"
            [class.error]="resetForm.get('newPassword')?.invalid && resetForm.get('newPassword')?.touched"
            data-test="new-password-input"
          />
          @if (resetForm.get('newPassword')?.invalid && resetForm.get('newPassword')?.touched) {
            <div class="error-message">
              @if (resetForm.get('newPassword')?.errors?.['required']) {
                New password is required
              }
              @if (resetForm.get('newPassword')?.errors?.['minlength']) {
                Password must be at least 8 characters long
              }
            </div>
          }
        </div>

        <div class="form-group">
          <label for="confirm-new-password">Confirm New Password</label>
          <input
            id="confirm-new-password"
            type="text"
            formControlName="confirmNewPassword"
            placeholder="Confirm your new password"
            [class.error]="resetForm.get('confirmNewPassword')?.invalid && resetForm.get('confirmNewPassword')?.touched"
            data-test="confirm-new-password-input"
          />
          @if (resetForm.get('confirmNewPassword')?.invalid && resetForm.get('confirmNewPassword')?.touched) {
            <div class="error-message">
              @if (resetForm.get('confirmNewPassword')?.errors?.['required']) {
                Please confirm your new password
              }
              @if (resetForm.get('confirmNewPassword')?.errors?.['passwordMismatch']) {
                Passwords do not match
              }
            </div>
          }
        </div>

        @if (errorMessage()) {
          <div class="alert alert-error" data-test="reset-error">{{ errorMessage() }}</div>
        }

        @if (successMessage()) {
          <div class="alert alert-success" data-test="reset-success">{{ successMessage() }}</div>
        }

        <button 
          type="submit" 
          class="btn-primary btn-full-width" 
          [disabled]="!resetForm.valid || processing()"
          data-test="reset-confirm-btn"
        >
          {{ processing() ? 'Resetting Password...' : 'Reset Password' }}
        </button>
        
      </form>

      <div class="auth-switch">
        <p>
          <button type="button" class="link-btn" (click)="navigateToLogin()" data-test="goto-login-btn">
            Back to Sign In
          </button>
          |
          <button type="button" class="link-btn" (click)="navigateToSignup()" data-test="goto-signup-btn">
            Create New Account
          </button>
        </p>
      </div>
    </div>

    <div class="reset-info">
      <h3>Password Reset Process</h3>
      <div class="info-content">
        <div class="info-item">
          <span class="info-icon">üìß</span>
          <div>
            <strong>Step 1: Request Code</strong>
            <p>Enter your email address and click "Send Reset Code" to receive a 6-digit reset code.</p>
          </div>
        </div>
        
        <div class="info-item">
          <span class="info-icon">üîë</span>
          <div>
            <strong>Step 2: Enter Code</strong>
            <p>Check your email for the reset code and enter it along with your new password.</p>
          </div>
        </div>
        
        <div class="info-item">
          <span class="info-icon">‚è∞</span>
          <div>
            <strong>Code Expires</strong>
            <p>Reset codes are valid for 1 hour. Request a new code if yours has expired.</p>
          </div>
        </div>
        
        <div class="info-item">
          <span class="info-icon">üîí</span>
          <div>
            <strong>Secure Process</strong>
            <p>Your password is encrypted and securely stored. Only you can reset your password.</p>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>