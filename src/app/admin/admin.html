<div class="admin-page">
  <header class="page-header">
    <div class="title-section">
      <h1>ğŸ”§ Admin Panel</h1>
      <p>Database management and system administration</p>
    </div>
  </header>


  <!-- Sample Data Initialization Section -->
  <div class="admin-section">
    <div class="section-header">
      <h2>ğŸŒŸ Initialize Sample Data</h2>
      <p>Create sample document types for testing and development</p>
    </div>
    
    <div class="action-panel">
      <div class="export-info">
        <div class="info-item">
          <strong>Sample Document Types:</strong>
          <ul>
            <li>Building Permit Application</li>
            <li>Environmental Impact Assessment</li>
            <li>Business License Application</li>
            <li>Health Department Permit</li>
          </ul>
        </div>
        <div class="info-item">
          <strong>Note:</strong> Existing records will not be duplicated
        </div>
      </div>
      
      <div class="action-controls">
        <button 
          class="btn-primary large" 
          (click)="initializeSampleData()" 
          [disabled]="initSampleDataLoading()"
        >
          @if (initSampleDataLoading()) {
            <span class="loading-spinner"></span>
            Initializing...
          } @else {
            ğŸŒŸ Initialize Sample Data
          }
        </button>

        @if (initSampleDataStatus()) {
          <div class="status-message">
            <button 
              class="clear-status-btn" 
              (click)="clearInitSampleDataStatus()"
              title="Clear status">âœ•</button>
            <pre>{{ initSampleDataStatus() }}</pre>
          </div>
        }
      </div>
    </div>
  </div>



  <!-- System Information -->
  <div class="admin-section">
    <div class="section-header">
      <h2>â„¹ï¸ System Information</h2>
      <p>Current system status and information</p>
    </div>
    
    <div class="info-panel">
      <div class="info-grid">
        <div class="info-card">
          <div class="info-label">System Version</div>
          <div class="info-value">DocFlow v4.0</div>
        </div>
        <div class="info-card">
          <div class="info-label">Current User</div>
          <div class="info-value">{{ currentUser()?.username || 'Unknown' }}</div>
        </div>
        <div class="info-card">
          <div class="info-label">User Role</div>
          <div class="info-value">Administrator</div>
        </div>
        <div class="info-card">
          <div class="info-label">Access Level</div>
          <div class="info-value">Full Access</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Active Flag Cleanup Section -->
  <div class="admin-section">
    <div class="section-header">
      <h2>ğŸ§¹ Active Flag Cleanup</h2>
      <p>Clean up active flags across all tables to ensure data integrity</p>
    </div>
    
    <div class="action-panel">
      <div class="export-info">
        <div class="info-item">
          <strong>What this does:</strong>
          <ul>
            <li>Loads all data from every table (Project, Document, User, DocumentType, Workflow, ChatRoom, ChatMessage)</li>
            <li>Sets the latest record per ID to <code>active = true</code></li>
            <li>Removes the active key entirely from older records</li>
            <li>Ensures proper data integrity across all versioned records</li>
          </ul>
        </div>
        <div class="info-item">
          <strong>âš ï¸ Important:</strong> This process may take several minutes for large datasets
        </div>
      </div>
      
      <div class="action-controls">
        <button 
          class="btn-warning large" 
          (click)="cleanupActiveFlagsAllTables()" 
          [disabled]="activeCleanupLoading()"
        >
          @if (activeCleanupLoading()) {
            <span class="loading-spinner"></span>
            Cleaning up...
          } @else {
            ğŸ§¹ Cleanup Active Flags
          }
        </button>

        @if (activeCleanupStatus()) {
          <div class="status-message">
            <button 
              class="clear-status-btn" 
              (click)="clearActiveCleanupStatus()" 
              title="Clear status message"
            >
              âœ•
            </button>
            <pre>{{ activeCleanupStatus() }}</pre>
          </div>
        }
      </div>
    </div>
  </div>

  <!-- AWS Resources -->
  <div class="admin-section">
    <div class="section-header">
      <h2>â˜ï¸ AWS Resources</h2>
      <p>AWS infrastructure resources used by the application</p>
    </div>
    
    <div class="resources-grid">
      <!-- AWS Resource Information -->
      <div class="resource-category">
        <h3>ğŸ” Authentication & Identity</h3>
        <div class="resource-items">
          @for (resource of awsResources() | keyvalue; track resource.key) {
            @if (resource.key.includes('Cognito') || resource.key.includes('Identity')) {
              <div class="resource-item">
                <div class="resource-type">{{ resource.key }}</div>
                <div class="resource-value">{{ resource.value }}</div>
              </div>
            }
          }
        </div>
      </div>

      <!-- AppSync & Storage -->
      <div class="resource-category">
        <h3>ğŸ”— API & Storage</h3>
        <div class="resource-items">
          @for (resource of awsResources() | keyvalue; track resource.key) {
            @if (resource.key.includes('AppSync') || resource.key.includes('S3')) {
              <div class="resource-item">
                <div class="resource-type">{{ resource.key }}</div>
                <div class="resource-value">{{ resource.value }}</div>
              </div>
            }
          }
        </div>
      </div>

      <!-- DynamoDB Tables -->
      <div class="resource-category">
        <h3>ğŸ—„ï¸ DynamoDB Tables</h3>
        <div class="resource-items">
          @if (tablesLoading()) {
            <div class="loading-item">
              <span class="loading-spinner"></span>
              <div class="loading-text">Loading tables from DynamoDB...</div>
            </div>
          } @else {
            @for (table of tableNames() | keyvalue; track table.key) {
              <div class="resource-item" 
                   [class.warning]="table.key.includes('âš ï¸') || table.key.includes('Fallback')"
                   [class.active-table]="table.key.includes('ACTIVE')"
                   [class.infrastructure]="table.key.includes('Infrastructure')">
                <div class="resource-type">{{ table.key }}</div>
                <div class="resource-value">{{ table.value }}</div>
              </div>
            }
          }
        </div>
      </div>

      <!-- Environment Info -->
      <div class="resource-category">
        <h3>ğŸŒ Environment</h3>
        <div class="resource-items">
          @for (resource of awsResources() | keyvalue; track resource.key) {
            @if (resource.key.includes('Region') || resource.key.includes('Environment')) {
              <div class="resource-item">
                <div class="resource-type">{{ resource.key }}</div>
                <div class="resource-value">{{ resource.value }}</div>
              </div>
            }
          }
        </div>
      </div>
    </div>
  </div>

  <!-- Lambda Functions -->
  <div class="admin-section">
    <div class="section-header">
      <h2>âš¡ Lambda Functions</h2>
      <p>Serverless functions deployed in the project</p>
    </div>
    
    <div class="lambda-functions-panel">
      <div class="functions-list">
        @for (func of lambdaFunctions(); track func) {
          <div class="function-item" [class.disabled]="func.includes('DISABLED')">
            @if (func.includes('DISABLED')) {
              <span class="function-status disabled">ğŸš«</span>
            } @else {
              <span class="function-status active">âœ…</span>
            }
            <div class="function-details">
              <div class="function-name">{{ func.split(' - ')[0] }}</div>
              @if (func.includes(' - ')) {
                <div class="function-description">{{ func.split(' - ')[1] }}</div>
              }
            </div>
          </div>
        }
      </div>
    </div>
  </div>

  <!-- Backup/Restore Section -->
  <div class="admin-section">
    <div class="section-header">
      <h2>ğŸ’¾ Backup & Restore</h2>
      <p>Export and import Document Types, Workflows, and Projects</p>
    </div>
    
    <div class="backup-restore-panel">
      <div class="backup-section">
        <h3>ğŸ“¤ Create Backup</h3>
        <p>Export selected data types to a JSON file</p>
        
        <div class="backup-options">
          <div class="checkbox-group">
            <label class="checkbox-label">
              <input 
                type="checkbox" 
                [(ngModel)]="backupOptions.documentTypes"
                class="checkbox-input"
              >
              <span class="checkmark"></span>
              Document Types
            </label>
            <label class="checkbox-label">
              <input 
                type="checkbox" 
                [(ngModel)]="backupOptions.workflows"
                class="checkbox-input"
              >
              <span class="checkmark"></span>
              Workflows
            </label>
            <label class="checkbox-label">
              <input 
                type="checkbox" 
                [(ngModel)]="backupOptions.projects"
                class="checkbox-input"
              >
              <span class="checkmark"></span>
              Projects
            </label>
            <label class="checkbox-label">
              <input 
                type="checkbox" 
                [(ngModel)]="backupOptions.documents"
                class="checkbox-input"
              >
              <span class="checkmark"></span>
              Documents
            </label>
          </div>
        </div>
        
        <button 
          class="btn-primary" 
          (click)="createBackup()" 
          [disabled]="backupLoading() || !hasBackupSelection()"
        >
          @if (backupLoading()) {
            <span class="loading-spinner"></span>
            Creating Backup...
          } @else {
            ğŸ’¾ Create Backup
          }
        </button>
        
        @if (backupStatus()) {
          <div class="status-message">
            <button 
              class="clear-status-btn" 
              (click)="clearBackupStatus()"
              title="Clear status">âœ•</button>
            <pre>{{ backupStatus() }}</pre>
          </div>
        }
      </div>

      <div class="restore-section">
        <h3>ğŸ“¥ Restore from Backup</h3>
        <p>Import data from a previously created backup file</p>
        
        <div class="file-upload-area">
          <input 
            type="file" 
            #fileInput
            accept=".json"
            (change)="onBackupFileSelected($event)"
            class="file-input"
            id="backup-file-input"
          >
          <label for="backup-file-input" class="file-upload-label">
            ğŸ“ Choose Backup File
          </label>
          
          @if (selectedBackupFile) {
            <div class="selected-file">
              <span class="file-name">{{ selectedBackupFile.name }}</span>
              <button class="clear-file-btn" (click)="clearSelectedFile()">âœ•</button>
            </div>
          }
        </div>
        
        @if (selectedBackupFile) {
          <div class="restore-options">
            <div class="checkbox-group">
              <label class="checkbox-label">
                <input 
                  type="checkbox" 
                  [(ngModel)]="restoreOptions.documentTypes"
                  class="checkbox-input"
                >
                <span class="checkmark"></span>
                Restore Document Types
              </label>
              <label class="checkbox-label">
                <input 
                  type="checkbox" 
                  [(ngModel)]="restoreOptions.workflows"
                  class="checkbox-input"
                >
                <span class="checkmark"></span>
                Restore Workflows
              </label>
              <label class="checkbox-label">
                <input 
                  type="checkbox" 
                  [(ngModel)]="restoreOptions.projects"
                  class="checkbox-input"
                >
                <span class="checkmark"></span>
                Restore Projects
              </label>
              <label class="checkbox-label">
                <input 
                  type="checkbox" 
                  [(ngModel)]="restoreOptions.documents"
                  class="checkbox-input"
                >
                <span class="checkmark"></span>
                Restore Documents
              </label>
            </div>
            
            <div class="conflict-resolution">
              <h4>Existing Objects Handling:</h4>
              <div class="radio-group">
                <label class="radio-label">
                  <input 
                    type="radio" 
                    name="conflictResolution"
                    value="ignore"
                    [(ngModel)]="restoreOptions.conflictResolution"
                    class="radio-input"
                  >
                  <span class="radio-mark"></span>
                  Ignore existing objects (skip duplicates)
                </label>
                <label class="radio-label">
                  <input 
                    type="radio" 
                    name="conflictResolution"
                    value="update"
                    [(ngModel)]="restoreOptions.conflictResolution"
                    class="radio-input"
                  >
                  <span class="radio-mark"></span>
                  Update existing objects (overwrite with backup data)
                </label>
              </div>
              <div class="help-text">
                Choose how to handle objects that already exist in the database
              </div>
            </div>
            
            <button 
              class="btn-secondary" 
              (click)="restoreFromBackup()" 
              [disabled]="restoreLoading() || !hasRestoreSelection()"
            >
              @if (restoreLoading()) {
                <span class="loading-spinner"></span>
                Restoring...
              } @else {
                ğŸ“¥ Restore Data
              }
            </button>
          </div>
        }
        
        @if (restoreStatus()) {
          <div class="status-message">
            <button 
              class="clear-status-btn" 
              (click)="clearRestoreStatus()"
              title="Clear status">âœ•</button>
            <pre>{{ restoreStatus() }}</pre>
          </div>
        }
      </div>
    </div>
  </div>

  <!-- Clear Database Section -->
  <div class="admin-section">
    <div class="section-header">
      <h2>ğŸ—‘ï¸ Clear Database Tables</h2>
      <p>Permanently delete data from individual database tables or all at once</p>
    </div>
    
    <div class="action-panel">
      <div class="export-info">
        <div class="info-item">
          <strong>âš ï¸ Warning:</strong>
          <p style="color: #e74c3c; font-weight: 600; margin: 0.5rem 0;">
            These operations will permanently delete data from the selected tables. Each operation includes:
          </p>
          <ul style="color: #e74c3c;">
            <li>All current records</li>
            <li>All version history</li>
            <li>This operation cannot be undone</li>
          </ul>
        </div>
        <div class="info-item">
          <strong>Note:</strong> Make sure to create a backup first if needed. You can clear individual tables or all tables at once.
        </div>
      </div>
      
      <div class="table-clear-controls">
        <h3>Clear Individual Tables:</h3>
        <div class="table-buttons-grid">
          <!-- Document Types -->
          <div class="table-clear-item">
            <button 
              class="btn-table-clear" 
              (click)="clearTable('DocumentType')" 
              [disabled]="isTableClearing('DocumentType')"
            >
              @if (isTableClearing('DocumentType')) {
                <span class="loading-spinner"></span>
                Clearing...
              } @else {
                ğŸ—‘ï¸ Clear Document Types
              }
            </button>
            @if (getTableStatus('DocumentType')) {
              <div class="table-status-message">
                <button 
                  class="clear-status-btn" 
                  (click)="clearSingleTableStatus('DocumentType')"
                  title="Clear status">âœ•</button>
                <pre>{{ getTableStatus('DocumentType') }}</pre>
              </div>
            }
          </div>

          <!-- Workflows -->
          <div class="table-clear-item">
            <button 
              class="btn-table-clear" 
              (click)="clearTable('Workflow')" 
              [disabled]="isTableClearing('Workflow')"
            >
              @if (isTableClearing('Workflow')) {
                <span class="loading-spinner"></span>
                Clearing...
              } @else {
                ğŸ—‘ï¸ Clear Workflows
              }
            </button>
            @if (getTableStatus('Workflow')) {
              <div class="table-status-message">
                <button 
                  class="clear-status-btn" 
                  (click)="clearSingleTableStatus('Workflow')"
                  title="Clear status">âœ•</button>
                <pre>{{ getTableStatus('Workflow') }}</pre>
              </div>
            }
          </div>

          <!-- Projects -->
          <div class="table-clear-item">
            <button 
              class="btn-table-clear" 
              (click)="clearTable('Project')" 
              [disabled]="isTableClearing('Project')"
            >
              @if (isTableClearing('Project')) {
                <span class="loading-spinner"></span>
                Clearing...
              } @else {
                ğŸ—‘ï¸ Clear Projects
              }
            </button>
            @if (getTableStatus('Project')) {
              <div class="table-status-message">
                <button 
                  class="clear-status-btn" 
                  (click)="clearSingleTableStatus('Project')"
                  title="Clear status">âœ•</button>
                <pre>{{ getTableStatus('Project') }}</pre>
              </div>
            }
          </div>

          <!-- Documents -->
          <div class="table-clear-item">
            <button 
              class="btn-table-clear" 
              (click)="clearTable('Document')" 
              [disabled]="isTableClearing('Document')"
            >
              @if (isTableClearing('Document')) {
                <span class="loading-spinner"></span>
                Clearing...
              } @else {
                ğŸ—‘ï¸ Clear Documents
              }
            </button>
            @if (getTableStatus('Document')) {
              <div class="table-status-message">
                <button 
                  class="clear-status-btn" 
                  (click)="clearSingleTableStatus('Document')"
                  title="Clear status">âœ•</button>
                <pre>{{ getTableStatus('Document') }}</pre>
              </div>
            }
          </div>

          <!-- Users -->
          <div class="table-clear-item">
            <button 
              class="btn-table-clear" 
              (click)="clearTable('User')" 
              [disabled]="isTableClearing('User')"
            >
              @if (isTableClearing('User')) {
                <span class="loading-spinner"></span>
                Clearing...
              } @else {
                ğŸ—‘ï¸ Clear Users
              }
            </button>
            @if (getTableStatus('User')) {
              <div class="table-status-message">
                <button 
                  class="clear-status-btn" 
                  (click)="clearSingleTableStatus('User')"
                  title="Clear status">âœ•</button>
                <pre>{{ getTableStatus('User') }}</pre>
              </div>
            }
          </div>
        </div>

        <div class="clear-all-section">
          <h3>Clear All Tables:</h3>
          <div class="action-controls">
            <button 
              class="btn-secondary clear-all-btn" 
              (click)="clearDatabase()" 
              [disabled]="clearDatabaseLoading()"
            >
              @if (clearDatabaseLoading()) {
                <span class="loading-spinner"></span>
                Clearing All Data...
              } @else {
                ğŸ—‘ï¸ Clear ALL Tables
              }
            </button>

            @if (clearDatabaseStatus()) {
              <div class="status-message">
                <button 
                  class="clear-status-btn" 
                  (click)="clearClearDatabaseStatus()"
                  title="Clear status">âœ•</button>
                <pre>{{ clearDatabaseStatus() }}</pre>
              </div>
            }
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Clear Messages Button -->
  <div class="admin-section">
    <button class="btn-secondary" (click)="clearMessages()">
      ğŸ§¹ Clear All Messages
    </button>
  </div>
</div>